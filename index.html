<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><meta name="author" content="Cédric Champeau (@CedricChampeau), Gradle" /><title>: Recouvrer de la productivité avec Gradle 4</title><meta content="yes" name="apple-mobile-web-app-capable" /><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style" /><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport" /><link href="reveal.js/css/reveal.css" rel="stylesheet" /><link rel="stylesheet" href="reveal.js/css/theme/summit.css" id="theme" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css" /><link href="reveal.js/lib/css/zenburn.css" rel="stylesheet" /><script>document.write( '<link rel="stylesheet" href="reveal.js/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );</script><link rel="stylesheet" type="text/css" href="reveal.js/css/theme/asciinema-player.css" />
<link rel="stylesheet" type="text/css" href="reveal.js/css/theme/github-gist.css" />
<script src="reveal.js/css/theme/asciinema-player.js"></script>

</head><body><div class="reveal"><div class="slides"><section class="title" data-state="title" data-transition="zoom" data-transition-speed="fast" data-background-image="./images/title.jpeg"><h1></h1><h2>Recouvrer de la productivité avec Gradle 4</h2><p class="author"><small>Cédric Champeau (@CedricChampeau), Gradle</small></p></section><section id="who-am-i"><h2>Who am I</h2><style>
.asciinema-terminal.font-medium {
  font-size: 16px;
}
</style>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="groovy language-groovy">speaker {
    name 'Cédric Champeau'
    company 'Gradle Inc'
    oss 'Apache Groovy committer',
    successes 'Static type checker',
              'Static compilation',
              'Traits',
              'Markup template engine',
              'DSLs'
        failures Stream.of(bugs),
        twitter '@CedricChampeau',
        github 'melix',
        extraDescription '''Groovy in Action 2 co-author
Misc OSS contribs (Gradle plugins, deck2pdf, jlangdetect, ...)'''
}</code></pre></div></div></section>
<section id="agenda"><h2>Agenda</h2><div class="ulist"><ul><li><p>Gradle in a nutshell</p></li><li><p>Incremental builds</p></li><li><p>Build cache</p></li><li><p>Compile avoidance and incremental compilation</p></li><li><p>Composite builds</p></li><li><p>Worker API</p></li><li><p>Kotlin DSL</p></li><li><p>Dependency management</p></li><li><p>Build scans</p></li></ul></div></section>
<section><section id="gradle-in-a-nutshell" data-background-color="#01303a"><h2>Gradle in a nutshell</h2></section><section id="agnostic-build-system"><h2>Agnostic Build System</h2><div class="ulist"><ul><li><p>Java ecosystem</p><div class="ulist"><ul><li><p>Groovy, Kotlin, Scala, &#8230;&#8203;</p></li></ul></div></li><li><p>Native ecosystem</p><div class="ulist"><ul><li><p>C, C++, Swift, &#8230;&#8203;</p></li></ul></div></li><li><p>Android</p></li><li><p>Misc</p><div class="ulist"><ul><li><p>Go, Asciidoctor, &#8230;&#8203;</p></li></ul></div></li></ul></div></section></section>
<section><section id="code-6-code" data-background-color="#01303a"><h2><code>6</code></h2></section><section id="gradle-in-figures"><h2>Gradle in figures</h2><div class="ulist"><ul><li class="fragment"><p>4.0M downloads / month</p></li><li class="fragment"><p><a href="https://techcrunch.com/2017/04/07/tracking-the-explosive-growth-of-open-source-software/">#17 OSS projects worldwide</a></p></li><li class="fragment"><p>35 Gradle Engineers</p></li><li class="fragment"><p>300K builds/week @LinkedIn</p></li></ul></div></section><section id="gradle"><h2>Gradle</h2><div class="imageblock" style=""><img src="./images/gradle-task-dag.png" alt="gradle task dag" width="1280" height="350px" /></div></section><section id="a-java-library"><h2>A Java library</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="groovy language-groovy">plugins {
   id 'java-library'
}

dependencies {
   api 'com.acme:foo:1.0'
   implementation 'com.zoo:monkey:1.1'
}</code></pre></div></div></section><section id="a-native-app"><h2>A native app</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="groovy language-groovy">plugins {
   id 'cpp-application'
}

repositories {
    maven {
        url 'http://localhost:8000/'
    }
}

dependencies {
    implementation 'org.gradle.cpp-samples:math:1.5'
}</code></pre></div></div></section><section id="native-dependency-management"><h2>Native dependency management</h2><div class="imageblock" style=""><img src="./images/04-google-test.gif" alt="04 google test" width="1280" height="500px" /></div></section></section>
<section><section id="incremental-builds" data-background-color="#01303a"><h2>Incremental builds</h2></section><section id="observation"><h2>Observation</h2><div class="paragraph"><p>Typically, not much changes in the build between consecutive invocations of the build.</p></div>
<div class="paragraph"><p>When little changes in the code, little work should be done by the build.</p></div>
<div class="paragraph"><p>Reuse of the outcomes of the previous run.</p></div></section><section id="task-inputs-outputs"><h2>Task inputs / outputs</h2><div class="paragraph"><p>Only run a task if its inputs or outputs have changed since the previous run.</p></div>
<div class="paragraph"><p>Inputs &#8594; [Task] &#8594; Outputs</p></div>
<div class="paragraph"><p>Example for Compile task:</p></div>
<div class="paragraph"><p>Task inputs: source files, libraries, compiler configuration, etc.
Task outputs: class files</p></div></section><section id="demo"><h2>Demo</h2><div class="paragraph"><p>
<div id="player-container-a7dee7c4-dff7-428c-a192-3c90a13472ef"></div>
  <script>
    asciinema_player.core.CreatePlayer('player-container-a7dee7c4-dff7-428c-a192-3c90a13472ef', 'incremental-build.json', { width: 114, height: 24, fontSize: 'medium' });
  </script>
</p></div></section><section id="learn-more"><h2>Learn more</h2><div class="ulist"><ul><li><p><a href="https://blog.gradle.org/introducing-incremental-build-support" class="bare">https://blog.gradle.org/introducing-incremental-build-support</a></p></li></ul></div></section></section>
<section><section id="build-cache" data-background-color="#01303a"><h2>Build cache</h2></section><section id="build-cache-2"><h2>Build cache</h2><div class="ulist"><ul><li><p>Reuse outcomes of any previous run (rather than just the last)</p></li><li><p>Local cache and remote cache</p></li><li><p>Task output caching</p></li></ul></div></section><section id="build-cache-3"><h2>Build cache</h2><div class="paragraph"><p>Calculate cache key from inputs, use output as cache value</p></div>
<div class="paragraph"><p>Inputs &#8594; [Task] &#8594; Outputs</p></div>
<div class="paragraph"><p>Example for compile task:</p></div>
<div class="ulist"><ul><li><p>Cache key: hash(source files, libraries, compiler configuration, etc.)</p></li><li><p>Cache value : fileTree(class files)</p></li></ul></div></section><section id="demo-2"><h2>Demo</h2><div class="paragraph"><p>
<div id="player-container-86f7df61-867c-4c2e-902b-ffd31226713a"></div>
  <script>
    asciinema_player.core.CreatePlayer('player-container-86f7df61-867c-4c2e-902b-ffd31226713a', 'build-cache.json', { width: 114, height: 24, fontSize: 'medium' });
  </script>
</p></div></section><section id="integration-with-ci"><h2>Integration with CI</h2><div class="imageblock" style=""><img src="./images/build-cache.png" alt="build cache" width="350" height="350" /></div></section><section id="integration-with-ci-2"><h2>Integration with CI</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="groovy language-groovy">buildCache {
   local {
      enabled = !isCI
   }
   remote(HttpBuildCache) {
      url = 'https://my.ge.server/cache/'
      push = isCI
   }
}</code></pre></div></div></section><section id="build-cache-impact"><h2>Build cache impact</h2><div class="paragraph"><p><span class="image"><img src="./images/build-cache-effect.png" alt="build cache effect" width="1280" height="350px" /></span></p></div></section><section id="build-cache-on-android"><h2>Build cache on Android</h2><div class="paragraph"><p>Gradle tasks are cacheable as of Android plugin 3.0</p></div></section></section>
<section><section id="compile-avoidance" data-background-color="#01303a"><h2>Compile avoidance</h2></section><section id="compile-avoidance-2"><h2>Compile avoidance</h2><div class="paragraph"><p>Avoid wasting time compiling source classes that do not have to be compiled.</p></div></section><section id="compile-avoidance-3"><h2>Compile avoidance</h2><div class="ulist"><ul><li><p>(for all) only recompile classes affected by changed classes</p></li><li><p>(for all) only recompile on ABI changes</p></li><li><p>(Java library plugin) api/implementation dependencies separation</p></li></ul></div></section><section id="recompile-producer-only"><h2>Recompile producer only</h2><div class="paragraph"><p>
<div id="player-container-9d10591f-452d-43a2-baa5-c8ed368fa983"></div>
  <script>
    asciinema_player.core.CreatePlayer('player-container-9d10591f-452d-43a2-baa5-c8ed368fa983', 'ca-recompile-producer-only.json', { width: 114, height: 24, fontSize: 'medium' });
  </script>
</p></div></section><section id="performance-improvements"><h2>Performance improvements</h2><div class="imageblock" style=""><img src="./images/compile-avoidance.png" alt="compile avoidance" width="1280" height="500px" /></div></section><section id="learn-more-2"><h2>Learn more</h2><div class="ulist"><ul><li><p><a href="https://blog.gradle.org/incremental-compiler-avoidance" class="bare">https://blog.gradle.org/incremental-compiler-avoidance</a></p></li><li><p><a href="https://docs.gradle.org/current/userguide/java_plugin.html" class="bare">https://docs.gradle.org/current/userguide/java_plugin.html</a></p></li></ul></div></section></section>
<section><section id="incremental-compilation" data-background-color="#01303a"><h2>Incremental compilation</h2></section><section id="incremental-compilation-2"><h2>Incremental compilation</h2><div class="ulist"><ul><li><p>Analyze dependencies between classes</p></li><li><p>Only recompile classes affected by an ABI change</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="groovy language-groovy">tasks.withType(JavaCompile) {
    // will probably be default in 5.0
    options.incremental = true
}</code></pre></div></div></section></section>
<section><section id="composite-builds" data-background-color="#01303a"><h2>Composite builds</h2></section><section id="composite-builds-use-cases"><h2>Composite builds use cases</h2><div class="ulist"><ul><li><p>Fix a bug in a library through app using project</p></li><li><p>Break down a monolith into multiple repos</p></li><li><p>Consume latest state of libraries in integrations builds</p></li></ul></div></section><section id="demo-3"><h2>Demo</h2><div class="paragraph"><p>
<div id="player-container-2af73d51-c549-41db-a5e1-82ea007d3487"></div>
  <script>
    asciinema_player.core.CreatePlayer('player-container-2af73d51-c549-41db-a5e1-82ea007d3487', 'composite-build.json', { width: 114, height: 24, fontSize: 'medium' });
  </script>
</p></div></section><section id="learn-more-3"><h2>Learn more</h2><div class="ulist"><ul><li><p><a href="https://blog.gradle.org/introducing-composite-builds" class="bare">https://blog.gradle.org/introducing-composite-builds</a></p></li><li><p><a href="https://blog.jetbrains.com/idea/2017/03/webinar-recording-composite-builds-with-gradle" class="bare">https://blog.jetbrains.com/idea/2017/03/webinar-recording-composite-builds-with-gradle</a></p></li><li><p><a href="https://docs.gradle.org/current/userguide/composite_builds.html" class="bare">https://docs.gradle.org/current/userguide/composite_builds.html</a></p></li></ul></div></section></section>
<section><section id="worker-api" data-background-color="#01303a"><h2>Worker API</h2></section><section id="worker-api-2"><h2>Worker API</h2><div class="ulist"><ul><li><p>API to run task actions in parallel safely</p></li><li><p>Parallel actions cannot mutate shared state</p></li><li><p>Supports out-of-process and in-process actions</p></li></ul></div></section><section id="worker-api-3"><h2>Worker API</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">workerExecutor.submit(IsolatedRunner.class, new Action&lt;WorkerConfiguration&gt;() {
   @Override
   public void execute(final WorkerConfiguration conf) {
      conf.setIsolationMode(IsolationMode.PROCESS);
      conf.classpath(...);
      conf.params(...);
      conf.getForkOptions()
          .getSystemProperties()
          .put(JAVA_IO_TMPDIR, getTemporaryDir());
    }
});</code></pre></div></div></section></section>
<section><section id="kotlin-dsl" data-background-color="#01303a"><h2>Kotlin DSL</h2></section><section id="kotlin-dsl-goals"><h2>Kotlin DSL goals</h2><div class="ulist"><ul><li><p>Syntax highlighting</p></li><li><p>Quick documentation</p></li><li><p>Navigation to source</p></li><li><p>Auto-completion / content assist</p></li><li><p>Refactoring</p></li><li><p>High execution time performance</p></li></ul></div>
<div class="paragraph"><p><strong>Build code is no different to application code!</strong></p></div></section><section id="demo-4"><h2>Demo</h2><div class="paragraph"><p>Hey, Cédric, open your IDE.</p></div></section><section id="learn-more-4"><h2>Learn more</h2><div class="ulist"><ul><li><p><a href="https://blog.gradle.org/kotlin-meets-gradle" class="bare">https://blog.gradle.org/kotlin-meets-gradle</a></p></li><li><p><a href="https://github.com/gradle/kotlin-dsl" class="bare">https://github.com/gradle/kotlin-dsl</a></p></li></ul></div></section></section>
<section><section id="build-scans" data-background-color="#01303a"><h2>Build scans</h2></section><section id="build-scans-2"><h2>Build scans</h2><div class="ulist"><ul><li><p>Gain build insights</p></li><li><p>Improve build performance</p></li><li><p>Collaborate with colleagues and the community</p></li></ul></div></section><section id="build-scans-3"><h2>Build scans</h2><div class="imageblock" style=""><img src="./images/build-scan.png" alt="build scan" width="1280" height="500px" /></div></section><section id="examples"><h2>Examples</h2><div class="ulist"><ul><li><p>Groovy build: <a href="https://scans.gradle.com/s/a5hebbcavjwmm" class="bare">https://scans.gradle.com/s/a5hebbcavjwmm</a></p></li><li><p>Cached build: <a href="https://scans.gradle.com/s/n3gnmoatywoei" class="bare">https://scans.gradle.com/s/n3gnmoatywoei</a></p></li></ul></div></section></section>
<section><section id="gradle-enterprise" data-background-color="#01303a"><h2>Gradle Enterprise</h2></section><section id="gradle-enterprise-2"><h2>Gradle Enterprise</h2><div class="ulist"><ul><li><p>Query scans</p></li><li><p>Compare scans</p></li><li><p>Use a high-performance, scalable build cache</p></li><li><p>Host within your firewall</p></li></ul></div></section></section>
<section><section id="road-to-gradle-5" data-background-color="#01303a"><h2>Road to Gradle 5</h2></section><section id="dependency-management-improvements"><h2>Dependency management improvements</h2><div class="ulist"><ul><li><p>variant-aware dependency management</p></li><li><p>dependency constraints</p></li><li><p>rich version constraints</p></li><li><p>Gradle metadata format</p></li></ul></div></section><section id="what-if"><h2>What if&#8230;&#8203;</h2><div class="ulist"><ul><li><p>You could tell that some versions are buggy?</p></li><li><p>You could fix published metadata?</p></li><li><p>You could lock dependencies?</p></li><li><p>You could explain that 2 modules are mutually exclusive?</p></li></ul></div></section><section id="blacklisting-versions"><h2>Blacklisting versions</h2><div class="listingblock"><div class="content"><pre class="highlight"><code>dependencies {
   constraints {
       implementation('org.foo:awesome-lib') {
           version {
               prefer '1.2'
               reject '1.1'
           }
           because 'Version 1.1 is buggy'
       }
   }
}</code></pre></div></div></section><section id="nicer-error-messages"><h2>Nicer error messages</h2><div class="listingblock"><div class="content"><pre class="highlight"><code>Execution failed for task ':buildInit:dependencies'.
&gt; Could not resolve all dependencies for configuration ':buildInit:runtimeClasspath'.
  &gt; Module 'com.google.collections:google-collections' has been rejected:
       Dependency path 'org.gradle:buildInit:4.6-20180125230000+0000'
          --&gt; 'org.codehaus.plexus:plexus-container-default:1.5.5'
          --&gt; 'com.google.collections:google-collections' prefers '1.0'
       Constraint path 'org.gradle:buildInit:4.6-20180125230000+0000'
          --&gt; 'org.gradle:core:4.6-20180125230000+0000'
          --&gt; 'org.gradle:baseServices:4.6-20180125230000+0000'
          --&gt; 'com.google.collections:google-collections' rejects all versions because of the following reason: Guava replaces google collections</code></pre></div></div></section><section id="variant-aware"><h2>Variant-aware</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="text language-text">&gt; Task :subvola:gorgoneum:teerer:polytonal:dependencyInsight
project :outissue:carnally
   variant "debugRuntimeElements" [
      com.android.build.api.attributes.BuildTypeAttr      = debug
      com.android.build.gradle.dependency.VariantAttr     = debug (not requested)
      org.gradle.usage                                    = java-runtime
      com.android.build.gradle.dependency.AndroidTypeAttr = Aar
   ]</code></pre></div></div></section><section id="new-module-metadata"><h2>New module metadata</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="json language-json">{
  "formatVersion": "0.3",
  "component": {
    "group": "test",
    "module": "testApp",
    "version": "1.0",
    "attributes": {
      "org.gradle.status": "release"
    }
  },
  "createdBy": {
    "gradle": {
      "version": "4.5",
      "buildId": "6unkpkmor5h4fdn6p6bzdpdovu"
    }
  },
  "variants": [
    {
      "name": "debug-runtime",
      "attributes": {
        "org.gradle.native.debuggable": true,
        "org.gradle.native.optimized": false,
        "org.gradle.usage": "native-runtime"
      },
      "available-at": {
        "url": "../../testApp_debug/1.0/testApp_debug-1.0.module",
        "group": "test",
        "module": "testApp_debug",
        "version": "1.0"
      }
    },
    {
      "name": "release-runtime",
      "attributes": {
        "org.gradle.native.debuggable": true,
        "org.gradle.native.optimized": true,
        "org.gradle.usage": "native-runtime"
      },
      "available-at": {
        "url": "../../testApp_release/1.0/testApp_release-1.0.module",
        "group": "test",
        "module": "testApp_release",
        "version": "1.0"
      }
    }
  ]
}</code></pre></div></div></section><section id="source-dependencies"><h2>Source dependencies</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="groovy language-groovy">sourceControl {
   vcsMappings {
      withModule("org.test:greeter") {
         from(GitVersionControlSpec) {
            url = "git@github.com:orgtest/greeter.git"
         }
      }
   }
}</code></pre></div></div></section><section id="metadata-rules"><h2>Metadata rules</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="groovy language-groovy">withVariant('runtime') {
   withDependencies {
      it.findAll { it.group == 'org.slf4j' }.each {
         it.version { prefer '1.7.10' }
      }
   }
}</code></pre></div></div></section></section>
<section><section id="conclusion" data-background-color="#01303a"><h2>Conclusion</h2></section><section id="conclusion-2"><h2>Conclusion</h2><div class="ulist"><ul><li><p>Slides: <a href="https://melix.github.io/nantesjug-gradle-4" class="bare">https://melix.github.io/nantesjug-gradle-4</a></p></li><li><p>Discuss: @CedricChampeau</p></li></ul></div></section></section>
<section id="thanks" data-background-color="#01303a"><h2>Thanks!</h2></section></div></div><script src="reveal.js/lib/js/head.min.js"></script><script src="reveal.js/js/reveal.js"></script><script>// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display controls in the bottom right corner
  controls: true,
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: true,
  // Push each slide change to the browser history
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  previewLinks: false,
  // Theme (e.g., beige, black, league, night, serif, simple, sky, solarized, white)
  // NOTE setting the theme in the config no longer works in reveal.js 3.x
  //theme: Reveal.getQueryHash().theme || 'summit',
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: Reveal.getQueryHash().transition || 'linear',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 960,
  height: 700,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
      { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
      { src: 'reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
  ]
});</script></body></html>